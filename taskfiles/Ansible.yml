version: '3'

vars:
  ANSIBLE_DIR: "../ansible"

tasks:
  install:
    desc: Install both Ansible collections and roles
    cmds:
      - task: install:collection
      - task: install:roll

  install:collection:
    desc: Install Ansible Collection dependencies
    dir: "{{.ANSIBLE_DIR}}"
    cmds:
      - ansible-galaxy install -r requirements.yml

  install:roll:
    desc: Install Ansible Role dependencies
    dir: "{{.ANSIBLE_DIR}}"
    cmds:
      - ansible-galaxy role install -r roles/requirements.yml

  run:
    desc: |
      Runs Ansible playbooks.
      Usage:
        task run # Runs site.yml(default)
        task run -- xxx.yml # Runs xxx.yml
    dir: "{{.ANSIBLE_DIR}}"
    vars:
      PLAYBOOK: "{{.CLI_ARGS | default \"site.yml\"}}"
    cmds:
      - ansible-playbook {{.PLAYBOOK}}
